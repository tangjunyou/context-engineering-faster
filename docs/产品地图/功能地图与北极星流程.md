# 功能地图与北极星流程

本文档把当前仓库的能力，按“用户从 0 到 1 的真实使用顺序”汇总成一张可执行的产品地图，用于统一 IA/导航、减少功能割裂，并作为后续验收用例的基线。

## 北极星流程（从 0 到 1 的顺序）

1. 选择/创建项目（Project）
2. 配置资源（Resources）
   - 模型 Provider（Chat/Embeddings）
   - 数据库（SQL：内置 SQLite / 外部 Postgres/MySQL）
   - 向量库（内置 Vector / 外部 Milvus）
3. 管理数据（Data）
   - 导入/建表/浏览行数据/示例数据
4. 定义变量（Variables）
   - 静态变量
   - 动态变量（抽取器/解析器：sql/chat/neo4j/milvus）
5. 组装配方（Recipe / Context）
   - 画布编辑
   - 插入变量占位符
   - 预览与 trace 定位问题
6. 评测与回归（Evaluation）
   - Dataset → Runs → Compare
   - Jobs / Import History

## 对象模型（用户需要理解的“名词”）

- Project：一个可复现的工作空间；承载配方（画布）、项目变量、变量库、dataset/runs。
- Recipe（Context Flow）：画布上的节点与连线；输出一段可给 LLM 使用的上下文文本。
- Node：配方中的一段上下文片段（system/tools/memory/retrieval/messages 等）。
- Variable：上下文模板中的占位符 `{{name}}`；静态值或动态解析。
- Resolver（Scheme）：动态变量的解析方式，例如 `sql://<dsId>`、`chat://<sessionId>`、`milvus://<dsId>`。
- DataSource：数据库/图数据库/向量库的连接与权限开关的集合（URL/token 等在本地加密保存）。
- Provider：模型服务端点配置（用于 embeddings/chat 测试与后续 job）。
- Dataset：一组输入样本；用于批量回放生成 runs。
- Run：一次回放的运行结果；包含 trace 与输出摘要，用于稳定性对比。
- Job：长任务（例如把数据嵌入到向量库）。
- Session：消息历史（供 `chat://` 解析器使用）。
- Vector Collection：内置向量库或 Milvus 中的一组向量集合。

## 功能入口（现状 → 建议归属）

### 配方（Recipe / Context）

- 现状入口：`/workbench/context`（三栏 IDE：左侧变量/组件/数据源，右侧预览/属性）。
- 建议：作为默认首页；只保留与配方编辑强相关的入口（组件库、项目变量、预览/trace）。

### 变量（Variables）

- 现状入口：`/workbench/variables`（变量库 + 抽取器）；同时上下文装配左侧也有 VariableManager。
- 建议：变量页统一承载“项目变量 + 变量库 + 抽取器”；配方页变量面板只做引用与跳转。

### 数据库（Database）

- 现状入口：DataSourceManager + SqlBrowserDialog（隐藏在按钮条与弹窗里）。
- 建议：数据库成为一级模块：内置 SQLite（推荐）与外部 DB（高级）；提供可视化向导与 Query Builder，一键生成变量。

### 向量库（Vector）

- 现状入口：VectorStudioDialog（偏 JSON prompt）；Milvus 仅少量能力且缺少创建入口。
- 建议：向量库成为一级模块：内置 Vector（默认可用）与 Milvus（企业级）；统一入口与能力说明，补齐最小闭环。

### 评测（Evaluation）

- 现状入口：DatasetCenterDialog/JobCenterDialog/ImportHistoryDialog（同样隐藏在按钮条与弹窗里）。
- 建议：评测成为一级模块：Dataset → Runs → Compare 是主路径；Jobs/Import History 为辅助能力。

### 项目与状态（Project）

- 现状入口：上下文装配页头部与其它工作台 header 中的 ProjectManagerDialog。
- 建议：顶栏固定展示项目状态（已保存/未保存、当前 projectId），并提供“下一步”主 CTA。

## 错误与回退（体验要求）

- 空态必须只有一个主 CTA（避免“无从下手”）。
- 缺失变量必须提供可执行动作：一键创建静态占位，或进入动态变量向导。
- 失败信息必须可操作：原因 + 下一步建议（使用结构化 errorCode 映射到动作）。

