# 新手黄金路径验收规范

本文档用于把“新手直觉友好”的目标落成可验收、可回归的规格，并与自动化测试/CI 门禁对齐。

## 定义
- 黄金路径：新手在最少决策成本下完成一次可复现的上下文配方运行，并能从 trace 中定位问题。
- 新手：不理解上下文工程术语，但能跟随 UI 完成操作。

## GP1：从空白到第一次成功运行
### 前置
- 新项目/空画布（nodes 为空或用户选择“从空白开始”）。

### 步骤
1. 用户点击“快速开始/选择模板”。
2. 用户选择一个模板（例如“最小可运行”）。
3. 画布生成一组默认节点（至少含 system 节点），并包含示例变量（至少 1 个静态变量）。
4. 用户点击“运行/预览”，获得输出文本与 trace。

### 验收
- 生成的节点可直接运行成功（trace.segments 存在，trace.text 非空）。
- trace 中能看到每个节点的 template 与 rendered。
- 若模板中包含变量，占位符必须被替换或在 trace 中明确标注缺失变量。

## GP2：绑定一个动态变量并验证
### 目标
用户不需要理解 “resolver scheme”，也能通过 Builder 完成一次动态变量绑定并看到结果/错误建议。

### 步骤（以 SQL 为例）
1. 用户进入变量面板，点击“创建变量/抽取器”。
2. 选择类型为“动态”，选择抽取器类型为“SQL”。
3. 选择数据源或输入 SQLite 连接信息与查询（只读 SELECT/WITH）。
4. 点击“测试变量”，看到测试结果或可操作错误提示。
5. 变量可用于上下文模板，运行时由后端 preview 解析并写入 trace。

### 验收
- 测试成功：UI 显示解析结果，并可保存到变量库。
- 测试失败：UI 显示失败原因，并给出至少一个可执行修复动作（检查数据源/检查只读 SQL/检查超时），且建议来自结构化错误码而非纯文案。
- 运行预览：trace.messages 或 segment.messages 中包含 `variable_resolved` 或 `variable_resolve_failed` 契约事件。
- 契约字段：当出现 `variable_resolve_failed` 时，details 至少包含 `variableId/variableName/errorCode`，UI 必须能基于 errorCode 映射“下一步怎么做”。  

## GP3：Dataset 批量回放与对比
### 目标
用户能在不改上下文配方的前提下，用一组输入重复运行并对比结果，确保可复现与不跑偏。

### 步骤
1. 用户导入或创建一个 dataset（CSV/JSON 任一）。
2. 用户选择 dataset，点击“批量回放/运行”。
3. 系统产出运行结果列表（每条输入至少包含 runId、状态、输出摘要、缺失变量计数）。
4. 用户可以点击某条结果打开 trace 复盘。

### 验收
- 批量运行可完成并产生可回放记录。
- 对同一 dataset 重复运行，在输入与配置不变时输出结构保持一致（允许时间戳/ID 不同），并提供 `outputDigest` 用于稳定性对比。
- 任一失败条目必须可定位到：哪个变量/哪个节点/哪个抽取器失败。
- Dataset/Run 语义与接口以 [Dataset回放与Run记录规范.md](file:///Users/jingshun/Desktop/上下文工程项目/docs/测试文档/Dataset回放与Run记录规范.md) 为准。

## 统一可用性与可解释性要求
- 空态必须给出主 CTA（下一步只有一个最重要动作）。
- 缺失变量必须可一键创建（生成静态占位变量）或一键跳转到变量创建入口。
- 失败信息必须是“可操作”的：提示原因 + 下一步建议。
